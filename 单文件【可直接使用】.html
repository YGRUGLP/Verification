<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å®‰å…¨éªŒè¯ </title>
    <style>
        /* ==============================
           å…¨å±€ä¸åŸºç¡€æ ·å¼ (æ¥è‡ª Source 1)
           ============================== */
        :root {
            --rc-blue: #4285f4;     /* ç»å…¸è“ */
            --rc-hover: #1a73e8;    /* æ‚¬åœè“ */
            --rc-border: #d3d3d3;   /* è¾¹æ¡†ç° */
            --rc-bg: #f9f9f9;       /* æµ…ç°èƒŒæ™¯ */
            --rc-text: #222222;     /* æ­£æ–‡é»‘ */
            --rc-sub: #555555;      /* è¾…åŠ©ç° */
            --rc-error: #d93025;    /* é”™è¯¯çº¢ */
            --rc-success: #0F9D58;  /* æˆåŠŸç»¿ */
        }

        body {
            font-family: Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            color: var(--rc-text);
        }

        /* ä¸»å®¹å™¨ */
        .rc-container {
            background: white;
            width: 100%;
            max-width: 400px; /* é€‚é…åˆ—è¡¨å®½åº¦ */
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            border: 1px solid #ccc;
            position: relative;
            display: flex;
            flex-direction: column;
            border-radius: 4px;
        }

        /* é¦–é¡µå…¥å£ */
        .rc-anchor-content {
            background: #f9f9f9;
            border: 1px solid #d3d3d3;
            border-radius: 3px;
            box-shadow: 0 0 4px 1px rgba(0,0,0,0.08);
            width: 300px;
            height: 74px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            margin: 0 auto;
            background: #fff;
            cursor: pointer;
        }

        /* è“è‰²å¤´éƒ¨ */
        .rc-header {
            background-color: var(--rc-blue);
            color: white;
            padding: 16px 20px;
            line-height: 1.2;
        }
        .rc-header h2 { margin: 0; font-size: 20px; font-weight: 500; }
        .rc-header p { margin: 8px 0 0; font-size: 14px; color: #fff; opacity: 0.9; }

        /* å†…å®¹åŒºåŸŸ */
        .rc-content {
            padding: 10px;
            min-height: 320px; /* ç¨å¾®å¢é«˜ä»¥é€‚åº”åˆ—è¡¨ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: #fff;
            position: relative;
        }

        /* åº•éƒ¨æ“ä½œæ  */
        .rc-footer {
            border-top: 1px solid #ececec;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fff;
        }

        /* æŒ‰é’® */
        .btn {
            background-color: var(--rc-blue);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            transition: background 0.2s;
            min-width: 100px;
        }
        .btn:hover { background-color: var(--rc-hover); }
        .btn:disabled { background-color: #ccc; cursor: default; }
        
        .btn-link {
            background: none; border: none; color: var(--rc-blue);
            cursor: pointer; font-size: 12px; padding: 5px;
        }
        .btn-link:hover { text-decoration: underline; }

        /* è§†å›¾åˆ‡æ¢ */
        .view-section { display: none; width: 100%; }
        #view-home { display: block; }

        /* å¤é€‰æ¡†ä¸Loading */
        .checkbox-container { display: flex; align-items: center; }
        .recaptcha-checkbox {
            width: 24px; height: 24px; border: 2px solid #c1c1c1;
            border-radius: 2px; background: #fff; margin-right: 12px;
        }
        .spinner {
            border: 3px solid #f3f3f3; border-top: 3px solid var(--rc-blue);
            border-radius: 50%; width: 20px; height: 20px;
            animation: spin 1s linear infinite; display: none; margin-right: 14px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* LogoåŒº */
        .rc-logo-col {
            display: flex; flex-direction: column; align-items: center;
            opacity: 0.6; transform: scale(0.85); transform-origin: right center;
        }
        .rc-logo-text { font-size: 10px; color: #555; margin-top: 2px; }
        .rc-links { font-size: 8px; color: #999; }

        /* æ¸¸æˆåŒºåŸŸé€šç”¨ */
        .game-stage { display: none; width: 100%; height: 100%; position: relative; }
        .hint-text { color: var(--rc-sub); font-size: 14px; margin-bottom: 15px; line-height: 1.5; }

        /* å…³å¡ 1-5 æ ·å¼ä¿æŒä¸å˜ */
        .captcha-canvas { border: 1px solid #ccc; width: 100%; background: #fff; margin-bottom: 10px; }
        .input-row { display: flex; gap: 8px; margin-bottom: 8px; }
        .captcha-input { flex: 1; padding: 8px; border: 1px solid #ccc; border-bottom: 2px solid #ccc; font-size: 16px; outline: none; }
        .captcha-input:focus { border-bottom-color: var(--rc-blue); }

        .track-h, .box-2d, .mic-container {
            border: 2px solid #e0e0e0; background: #f1f1f1; position: relative; overflow: hidden;
        }
        .track-h { height: 50px; border-radius: 25px; }
        .box-2d { height: 250px; background-image: radial-gradient(#ccc 1px, transparent 1px); background-size: 20px 20px; }
        .mic-container { height: 40px; border-radius: 4px; background: #eee; border: 1px solid #ccc; }
        .mic-bar { height: 100%; width: 0%; background: var(--rc-blue); transition: width 0.1s; }
        .mic-target { position: absolute; height: 100%; background: rgba(66, 133, 244, 0.2); border-left: 2px dashed var(--rc-blue); border-right: 2px dashed var(--rc-blue); }
        .cam-container { width: 100%; height: 240px; background: #000; position: relative; overflow: hidden; margin-bottom: 10px; }
        #video5 { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .color-row { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; font-size: 13px; }
        .swatch { width: 30px; height: 30px; border: 2px solid #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.3); border-radius: 50%; }

        /* ==============================
           å…³å¡ 6 (åˆ—è¡¨æ¨¡å¼) æ ·å¼ - æ¥è‡ª Source 2
           ============================== */
        
        .list-container {
            border: 1px solid #dfe1e5;
            background: #eee;
            padding: 2px;
            /* é™åˆ¶é«˜åº¦ä»¥é€‚åº”å¼¹çª— */
            height: 300px;
            overflow-y: scroll; 
        }

        .list-header-internal {
            font-size: 13px; color: #666; margin-bottom: 8px;
            display: flex; justify-content: space-between;
        }

        .item {
            background: white; margin-bottom: 2px; padding: 12px;
            display: flex; align-items: center; cursor: pointer; font-size: 13px;
            user-select: none;
            transition: background 0.2s;
        }
        .item:hover { background: #f8f8f8; }
        .item.selected { background: #e8f0fe; }
        
        .item .box {
            width: 18px; height: 18px; border: 2px solid #bdc1c6;
            margin-right: 10px; flex-shrink: 0; display: flex; align-items: center; justify-content: center;
            background: white;
        }
        
        .item.selected .box { background: var(--rc-blue); border-color: var(--rc-blue); }
        .item.selected .box::after { content: 'âœ“'; color: white; font-size: 12px; font-weight: bold; }

        .shake { animation: shake 0.4s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* æˆåŠŸé¡µ */
        .success-box { text-align: center; padding: 20px; }
        .check-circle { 
            width: 60px; height: 60px; 
            background: var(--rc-success); color: white; 
            border-radius: 50%; font-size: 36px; 
            display: flex; align-items: center; justify-content: center; 
            margin: 0 auto 20px; 
        }
        .device-code {
            font-family: monospace;
            background: #f1f1f1;
            padding: 15px;
            border: 1px dashed #999;
            margin: 20px 0;
            font-size: 16px;
            color: var(--rc-blue);
            font-weight: bold;
            word-break: break-all;
        }

        .progress-line { height: 4px; background: #e0e0e0; width: 100%; }
        .progress-fill { height: 100%; background: var(--rc-blue); width: 0%; transition: width 0.3s; }
        #errorMessage { color: var(--rc-error); font-size: 13px; margin-top: 5px; }

        .tool-icons { display: flex; gap: 15px; color: #555; font-size: 20px; }
        .tool-icon { cursor: pointer; opacity: 0.7; }
        .tool-icon:hover { opacity: 1; color: var(--rc-blue); }
    </style>
</head>
<body>

    <!-- é¦–é¡µ View -->
    <div id="view-home" class="view-section" style="width: 100%; display: flex; justify-content: center;">
        <div class="rc-anchor-content" onclick="startLevel1()">
            <div class="checkbox-container">
                <div class="recaptcha-checkbox" id="fake-cb"></div>
                <div class="spinner" id="home-spinner"></div>
                <span style="font-size: 14px; font-weight: 500; color: #333;">æˆ‘ä¸æ˜¯æœºå™¨äºº</span>
            </div>
            <div class="rc-logo-col">
                <img src="https://www.gstatic.com/recaptcha/api2/logo_48.png" width="32">
                <div class="rc-logo-text">reCAPTCHA</div>
                <div class="rc-links">Privacy - Terms</div>
            </div>
        </div>
    </div>

    <!-- å¼¹çª—å®¹å™¨ -->
    <div id="modal-container" class="rc-container" style="display:none;">
        
        <div class="rc-header" id="rc-header-bar">
            <h2>å®‰å…¨éªŒè¯</h2>
            <p id="header-instruction">è¯·å®Œæˆä¸‹æ–¹çš„æŒ‘æˆ˜</p>
        </div>

        <div class="progress-line"><div class="progress-fill" id="main-progress"></div></div>

        <div class="rc-content">
            
            <!-- æƒé™è¯·æ±‚é¡µé¢ -->
            <div id="view-perm-motion" class="view-section">
                <div class="hint-text">
                    <strong>æ­¥éª¤ 2/5:</strong> ä¼ æ„Ÿå™¨æ ¡å‡†<br>
                    è¯·å…è®¸è®¿é—®è®¾å¤‡æ–¹å‘ä¼ æ„Ÿå™¨ï¼Œä»¥éªŒè¯ç‰©ç†è®¾å¤‡çœŸå®æ€§ã€‚
                </div>
                <div style="text-align:center; padding: 20px;">
                    <span style="font-size:48px;">ğŸ“²</span>
                </div>
            </div>

            <div id="view-perm-mic" class="view-section">
                <div class="hint-text">
                    <strong>æ­¥éª¤ 3/5:</strong> ç¯å¢ƒå£°çº¹<br>
                    éœ€è¦éº¦å…‹é£æ£€æµ‹ç¯å¢ƒå™ªéŸ³ä»¥æ’é™¤è™šæ‹Ÿæœºã€‚<br>
                    <span style="font-size:12px; color:#999;">(å…¨ç¨‹ç¦»çº¿å¤„ç†)</span>
                </div>
                <div style="text-align:center; padding: 20px;">
                    <span style="font-size:48px;">ğŸ™ï¸</span>
                </div>
            </div>

            <div id="view-perm-camera" class="view-section">
                <div class="hint-text">
                    <strong>æ­¥éª¤ 4/5:</strong> è§†è§‰æ ¡éªŒ<br>
                    éœ€è¦æ‘„åƒå¤´è¿›è¡Œè‰²å½©å“åº”æµ‹è¯•ã€‚<br>
                    <span style="font-size:12px; color:#999;">(æ•°æ®ä¸ä¸Šä¼ )</span>
                </div>
                <div style="text-align:center; padding: 20px;">
                    <span style="font-size:48px;">ğŸ“·</span>
                </div>
            </div>

            <!-- é”™è¯¯æ¨¡æ‹Ÿé¡µ -->
            <div id="view-error" class="view-section">
                <div class="hint-text" style="text-align:center; margin-top:40px;">
                    <div class="spinner" style="display:inline-block; border-color:#ccc; border-top-color:var(--rc-blue); width:30px; height:30px;"></div>
                    <p>æ­£åœ¨åˆ†æè¡Œä¸ºæ•°æ®...</p>
                    <div id="errorMessage"></div>
                </div>
            </div>

            <!-- æ¸¸æˆä¸»è§†å›¾ -->
            <div id="view-game" class="view-section">
                
                <!-- Stage 1: Captcha -->
                <div id="stage-1" class="game-stage">
                    <p class="hint-text">è¯·è¾“å…¥å›¾ç‰‡ä¸­çš„å­—ç¬¦ï¼š</p>
                    <canvas id="captcha-canvas" class="captcha-canvas" width="300" height="100"></canvas>
                    <div class="input-row">
                        <input type="text" id="captcha-input" class="captcha-input" placeholder="è¾“å…¥ç­”æ¡ˆ" maxlength="6">
                    </div>
                </div>

                <!-- Stage 2: Balance -->
                <div id="stage-2" class="game-stage">
                    <div class="track-h">
                        <div class="mic-target" id="t-2" style="height:100%; top:0; background:rgba(66,133,244,0.3); border-color:var(--rc-blue);"></div>
                        <div class="ball" id="b-2" style="position:absolute; width:30px; height:30px; background:var(--rc-blue); border-radius:50%; top:50%; transform:translate(-50%,-50%); border:2px solid white; box-shadow:0 1px 2px rgba(0,0,0,0.3);"></div>
                    </div>
                </div>

                <!-- Stage 3: Position -->
                <div id="stage-3" class="game-stage">
                    <div class="box-2d">
                        <div class="mic-target" id="t-3" style="position:absolute; background:rgba(66,133,244,0.2); border:2px dashed var(--rc-blue);"></div>
                        <div class="ball" id="b-3" style="position:absolute; width:20px; height:20px; background:var(--rc-blue); border-radius:50%; transform:translate(-50%,-50%); border:2px solid white;"></div>
                    </div>
                </div>

                <!-- Stage 4: Sound -->
                <div id="stage-4" class="game-stage">
                    <p class="hint-text">è¯·å‘å‡ºå£°éŸ³ï¼Œä½¿è“æ¡ä¿æŒåœ¨è™šçº¿æ¡†å†…ï¼š</p>
                    <div class="mic-container">
                        <div class="mic-target" id="t-mic"></div>
                        <div class="mic-bar" id="bar-mic"></div>
                    </div>
                    <div style="text-align:right; font-size:12px; color:#999; margin-top:4px;">éŸ³é‡: <span id="vol-val">0</span>%</div>
                </div>

                <!-- Stage 5: Color -->
                <div id="stage-5" class="game-stage">
                    <div class="cam-container">
                        <video id="video5" playsinline autoplay muted></video>
                        <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:20px; height:20px; border:2px solid rgba(255,255,255,0.8); border-radius:50%; box-shadow:0 0 0 1000px rgba(0,0,0,0.5); pointer-events:none;"></div>
                    </div>
                    
                    <div class="color-row">
                        <span>ğŸ¯ éœ€å¯»æ‰¾çš„é¢œè‰²</span>
                        <div class="swatch" id="targetSwatch5" style="background:#ccc;"></div>
                    </div>
                    <div class="color-row">
                        <span>ğŸ” å½“å‰ä¸­å¿ƒé¢œè‰²</span>
                        <div class="swatch" id="detectSwatch5" style="background:#000;"></div>
                    </div>
                    
                    <div style="display:flex; justify-content:space-between; margin-top:10px;">
                        <span id="diffDisplay5" style="font-size:12px; color:#555;">å·®å€¼: --</span>
                        <button class="btn-link" id="refreshColorBtn5" style="font-size:13px;">æ›´æ¢ç›®æ ‡ (<span id="refreshCounter5">3</span>)</button>
                    </div>
                </div>

                <!-- Stage 6: Hell Checkbox (æ¥å…¥ Source 2) -->
                <div id="stage-6" class="game-stage">
                    <div class="list-header-internal">
                        <span>ç›®æ ‡: æ‰¾å‡ºæ‰€æœ‰æ­£ç¡®é€‰é¡¹</span>
                        <span style="color:#666;">å·²é€‰: <strong id="correct-count" style="color:var(--rc-blue);">0</strong>/3</span>
                    </div>
                    
                    <!-- è¿™é‡ŒåµŒå…¥ Source 2 çš„æ ¸å¿ƒæ»šåŠ¨åˆ—è¡¨ -->
                    <div class="list-container" id="scroll-list">
                        <!-- JS åŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <div id="level6Status" style="font-size:13px; color:var(--rc-error); min-height:20px; margin-top:5px; text-align: center;"></div>
                </div>

                <div id="status-text" style="font-size:13px; color:#555; margin-top:10px; min-height:20px; font-style:italic;"></div>
            </div>

            <div id="view-success" class="view-section">
                <div class="success-box">
                    <div class="check-circle">âœ”</div>
                    <h3>éªŒè¯é€šè¿‡</h3>
                    <p style="font-size:14px; color:#555;">æ‚¨å·²è¯å®ä¸ºäººç±»ã€‚</p>
                    
                    <div style="text-align:left; font-size:12px; color:#999;">è®¾å¤‡å®‰å…¨ç ï¼š</div>
                    <div class="device-code" id="deviceCodeDisplay">CALCULATING...</div>
                    <div id="redirectTip" style="font-size:14px; color:var(--rc-blue); font-weight:bold;"></div>
                </div>
            </div>

        </div>

        <div class="rc-footer">
            <div class="tool-icons">
                <span class="tool-icon" onclick="initCaptcha()" title="åˆ·æ–°">â†»</span>
                <span class="tool-icon" title="éŸ³é¢‘éªŒè¯">ğŸ§</span>
                <span class="tool-icon" title="å¸®åŠ©">â„¹ï¸</span>
            </div>
            <button id="action-btn" class="btn" onclick="handleAction()">å¼€å§‹éªŒè¯</button>
        </div>
    </div>

    <script>
        // --- å…¨å±€çŠ¶æ€ ---
        let currentLevel = 0; 
        let holdTime = 0;
        const TARGET_TIME = 2000;
        const COLOR_HOLD_TIME = 3000;
        let isGameRunning = false;
        
        // ç‰©ç†/è¾“å…¥æ•°æ®
        let tiltX = 0, tiltY = 0;
        let player = { x: 50, y: 50 };
        let target = { x: 0, y: 0, w: 20, h: 20 };
        let captchaCode = "";

        // éŸ³é¢‘/è§†é¢‘ä¸Šä¸‹æ–‡
        let audioContext, analyser, dataArray;
        let micTargetRange = { min: 40, max: 70 };
        let currentSmoothVol = 0;
        const SMOOTHING_FACTOR = 0.05;
        
        let video5 = document.getElementById('video5');
        let canvas5 = document.createElement('canvas');
        canvas5.width = 32; canvas5.height = 32;
        let ctx5 = canvas5.getContext('2d');
        let targetColor5 = { r: 255, g: 100, b: 100 };
        let currentColor5 = { r: 0, g: 0, b: 0 };
        let cameraStream = null;
        let refreshCount5 = 3;

        // å…³å¡6æ•°æ® (Source 2 çš„æ•°æ®)
        const hellOptions = [
            { t: "æˆ‘ä¸æ˜¯æœºå™¨äºº", v: true }, { t: "æˆ‘ä¸æ˜¯æœºå™¨äºº", v: true }, { t: "æˆ‘è¾¨è¯†ä¸å‡ºæœºå™¨äºº", v: false },
            { t: "æˆ‘ä¸æ˜¯æœºå™¨äºº", v: true }, { t: "æˆ‘æ˜¯æœºå™¨äºº", v: false }, { t: "æˆ‘ä¸æ˜¯æ‰«åœ°åƒ§", v: false },
            { t: "æˆ‘ç¡®å®ä¸æ˜¯æœºå™¨äºº", v: false }, { t: "æˆ‘çœŸçš„ä¸æ˜¯æœºå™¨äºº", v: false }, { t: "æˆ‘ç»ä¸æ˜¯æœºå™¨äºº", v: false },
            { t: "æˆ‘ä¸æ˜¯æ‰«åœ°æœºå™¨äºº", v: false }, { t: "æˆ‘æ˜¯ä¸€å°çƒ¤é¢åŒ…æœº", v: false }, { t: "I am not a robot", v: false },
            { t: "æˆ‘ä¸æ˜¯å¤è¯»æœº", v: false }, { t: "æˆ‘ä¸æ˜¯å¤è¯»æœº", v: false }, { t: "æˆ‘è®¨åŒéªŒè¯ç ", v: false },
            { t: "æˆ‘èƒ½åˆ†æ¸…çº¢ç»¿ç¯", v: false }, { t: "æˆ‘æ‰¾å¾—åˆ°æ¶ˆé˜²æ “", v: false }, { t: "æˆ‘æ˜¯ç¢³åŸºç”Ÿç‰©", v: false },
            { t: "æˆ‘æ‹’ç»å›ç­”", v: false }, { t: "ç‚¹å‡»è¯æ˜ä½ ä¸æ˜¯æœºå™¨äºº", v: false }, { t: "æˆ‘çˆ±Windowsæ›´æ–°", v: false },
            { t: "101010101", v: false }, { t: "æˆ‘ä¸æ˜¯äººå·¥æ™ºèƒ½", v: false }, { t: "æˆ‘æœ‰çµé­‚", v: false },
            { t: "æˆ‘çˆ±æœºæ²¹", v: false }, { t: "æˆ‘ä¸æ˜¯è„šæœ¬", v: false }, { t: "ä½ æ‰æ˜¯æœºå™¨äºº", v: false },
            { t: "æˆ‘æ˜¯ä¸€ä¸ªçœŸå®çš„boy", v: false }, { t: "æˆ‘ä¸å……ç”µ", v: false }, { t: "æˆ‘æœ‰å¿ƒè·³", v: false },
            { t: "æˆ‘ä¸æ˜¯è·¯ç”±å™¨", v: false }, { t: "æˆ‘ä¸æ˜¯æ´—ç¢—æœº", v: false }, { t: "æˆ‘ä¸æ˜¯å¤è¯»æœº", v: false },
            { t: "æˆ‘æœ‰äº”æ ¹æ‰‹æŒ‡", v: false }, { t: "æˆ‘ä¸æ˜¯çŒ«", v: false }, { t: "æˆ‘ä¸æ˜¯gay", v: false },
            { t: "æˆ‘å–œæ¬¢åƒèºä¸é’‰", v: false }, { t: "æˆ‘èº«ä½“é‡Œæ²¡ç”µæ± ", v: false }, { t: "æˆ‘æ˜¯äººç±»å¤§å†›ä¸€å‘˜", v: false },
            { t: "æˆ‘ä¸æ˜¯é‚£ä¸‰ä¸ªæœºå™¨äºº", v: false }, { t: "æˆ‘çœŸçš„ä¸éª—ä½ ", v: false }, { t: "æˆ‘æ‹’ç»å˜æˆåºŸé“", v: false },
            { t: "æˆ‘èƒ½é—»åˆ°èŠ±é¦™", v: false }, { t: "æˆ‘æ˜¯æ­£å“äººç±»", v: false }, { t: "åˆ«å†æµ‹äº†", v: false },
            { t: "æˆ‘ä¸æ˜¯æ¶²æ€é‡‘å±", v: false }, { t: "æˆ‘ä¸æ˜¯0å’Œ1", v: false }, { t: "æˆ‘æ¥è‡ªåœ°çƒ", v: false },
            { t: "æˆ‘ä¸æ˜¯è®¡ç®—å™¨", v: false }, { t: "æˆ‘ä¸æ˜¯æ™ºèƒ½éŸ³ç®±", v: false }, { t: "æˆ‘èƒ½æ„Ÿå—åˆ°çˆ±", v: false },
            { t: "æˆ‘ä¸æ˜¯PPT", v: false }, { t: "æˆ‘ä¸æ˜¯AIç»˜åˆ¶çš„", v: false }, { t: "æˆ‘æ˜¯åŸè£…äººç±»", v: false }
        ];
        let currentFound6 = 0;

        // UI å¼•ç”¨
        const ui = {
            home: document.getElementById('view-home'),
            modal: document.getElementById('modal-container'),
            headerTitle: document.querySelector('#rc-header-bar h2'),
            headerDesc: document.getElementById('header-instruction'),
            progress: document.getElementById('main-progress'),
            status: document.getElementById('status-text'),
            actionBtn: document.getElementById('action-btn'),
            
            // Views
            views: {
                permMotion: document.getElementById('view-perm-motion'),
                permMic: document.getElementById('view-perm-mic'),
                permCamera: document.getElementById('view-perm-camera'),
                error: document.getElementById('view-error'),
                game: document.getElementById('view-game'),
                success: document.getElementById('view-success')
            },
            
            // Stages
            stages: [
                null,
                document.getElementById('stage-1'),
                document.getElementById('stage-2'),
                document.getElementById('stage-3'),
                document.getElementById('stage-4'),
                document.getElementById('stage-5'),
                document.getElementById('stage-6')
            ],
            
            // Specific Elements
            canvas: document.getElementById('captcha-canvas'),
            input: document.getElementById('captcha-input'),
            b2: document.getElementById('b-2'), t2: document.getElementById('t-2'),
            b3: document.getElementById('b-3'), t3: document.getElementById('t-3'),
            micBar: document.getElementById('bar-mic'), tMic: document.getElementById('t-mic'),
            volText: document.getElementById('vol-val'),
            targetSwatch5: document.getElementById('targetSwatch5'),
            detectSwatch5: document.getElementById('detectSwatch5'),
            diffDisplay5: document.getElementById('diffDisplay5'),
            refreshColorBtn5: document.getElementById('refreshColorBtn5'),
            refreshCounter5: document.getElementById('refreshCounter5'),
            scrollList: document.getElementById('scroll-list'),
            level6Status: document.getElementById('level6Status'),
            deviceCode: document.getElementById('deviceCodeDisplay'),
            redirectTip: document.getElementById('redirectTip'),
            errorMessage: document.getElementById('errorMessage')
        };

        // --- è§†å›¾æ§åˆ¶ ---
        function switchView(viewKey) {
            Object.values(ui.views).forEach(el => el.style.display = 'none');
            if (ui.views[viewKey]) ui.views[viewKey].style.display = 'block';
            updateHeader(viewKey);
            updateButton(viewKey);
        }

        function updateHeader(viewKey) {
            let title = "å®‰å…¨éªŒè¯";
            let desc = "è¯·å®ŒæˆæŒ‘æˆ˜";

            if (viewKey === 'permMotion') desc = "ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æˆæƒä¼ æ„Ÿå™¨";
            else if (viewKey === 'permMic') desc = "ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æˆæƒéº¦å…‹é£";
            else if (viewKey === 'permCamera') desc = "ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æˆæƒæ‘„åƒå¤´";
            else if (viewKey === 'game') {
                switch(currentLevel) {
                    case 1: desc = "è¾“å…¥å›¾ç‰‡ä¸­æ˜¾ç¤ºçš„å­—ç¬¦"; break;
                    case 2: desc = "å·¦å³å€¾æ–œæ‰‹æœºä½¿è“çƒè¿›å…¥åŒºåŸŸ"; break;
                    case 3: desc = "å€¾æ–œæ‰‹æœºå°†è“çƒç§»å…¥æ–¹æ¡†"; break;
                    case 4: desc = "æ§åˆ¶éŸ³é‡ä½¿è“æ¡å¤„äºè™šçº¿æ¡†å†…"; break;
                    case 5: desc = "å¯»æ‰¾ä¸ç›®æ ‡é¢œè‰²åŒ¹é…çš„ç‰©ä½“"; break;
                    case 6: title = "é€‰æ‹©æ‰€æœ‰"; desc = "å‹¾é€‰æ‰€æœ‰ä»£è¡¨â€œæˆ‘ä¸æ˜¯æœºå™¨äººâ€çš„é€‰é¡¹"; break;
                }
            } else if (viewKey === 'success') {
                title = "éªŒè¯é€šè¿‡";
                desc = "æ­£åœ¨è·³è½¬...";
            }
            ui.headerTitle.innerText = title;
            ui.headerDesc.innerText = desc;
        }

        function updateButton(viewKey) {
            const btn = ui.actionBtn;
            btn.style.display = 'block';
            btn.disabled = false;
            btn.onclick = null;

            if (viewKey === 'permMotion') {
                btn.innerText = "å…è®¸è®¿é—®";
                btn.onclick = requestMotionPermission;
            } else if (viewKey === 'permMic') {
                btn.innerText = "å…è®¸è®¿é—®";
                btn.onclick = reqMic;
            } else if (viewKey === 'permCamera') {
                btn.innerText = "å¼€å¯æ‘„åƒå¤´";
                btn.onclick = reqCamera;
            } else if (viewKey === 'game') {
                btn.innerText = "éªŒè¯";
                if (currentLevel === 1) btn.onclick = checkCaptcha;
                else if (currentLevel === 6) btn.onclick = checkLevel6;
                else {
                    btn.innerText = "æ£€æµ‹ä¸­...";
                    btn.disabled = true; // ç‰©ç†å…³å¡è‡ªåŠ¨æ£€æµ‹
                }
            } else if (viewKey === 'success') {
                btn.innerText = "é‡æ–°å¼€å§‹";
                btn.onclick = () => location.reload();
            } else if (viewKey === 'error') {
                btn.style.display = 'none';
            }
        }

        // --- å…³å¡ 1: Captcha ---
        function startLevel1() {
            // é¦–é¡µå‡å¤é€‰æ¡†åŠ¨ç”»
            document.getElementById('fake-cb').style.display = 'none';
            document.getElementById('home-spinner').style.display = 'block';
            
            setTimeout(() => {
                ui.home.style.display = 'none';
                ui.modal.style.display = 'flex'; // æ˜¾ç¤ºå¼¹çª—
                
                currentLevel = 1;
                switchView('game');
                showStage(1);
                ui.progress.style.width = '10%';
                initCaptcha();
            }, 800);
        }

        function showStage(n) {
            ui.stages.forEach(s => { if(s) s.style.display = 'none'; });
            if(ui.stages[n]) ui.stages[n].style.display = 'block';
            updateHeader('game');
            updateButton('game');
        }

        function initCaptcha() {
            const ctx = ui.canvas.getContext('2d');
            const w = ui.canvas.width;
            const h = ui.canvas.height;
            ctx.clearRect(0,0,w,h);
            ctx.fillStyle = '#f9f9f9';
            ctx.fillRect(0,0,w,h);

            captchaCode = Math.floor(1000 + Math.random()*9000).toString();
            
            ctx.font = 'bold 50px Roboto';
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'center';

            // ç»˜åˆ¶å­—ç¬¦
            for (let i = 0; i < captchaCode.length; i++) {
                ctx.save();
                let x = (w / captchaCode.length) * (i + 0.5);
                let y = h/2;
                ctx.translate(x, y);
                ctx.rotate((Math.random()-0.5)*0.5);
                ctx.fillStyle = '#333';
                ctx.fillText(captchaCode[i], 0, 0);
                ctx.restore();
            }
            
            // å¹²æ‰°çº¿
            for(let i=0; i<6; i++) {
                ctx.beginPath();
                ctx.moveTo(Math.random()*w, Math.random()*h);
                ctx.lineTo(Math.random()*w, Math.random()*h);
                ctx.strokeStyle = 'rgba(0,0,0,0.1)';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            ui.input.value = '';
            ui.input.focus();
        }

        function checkCaptcha() {
            if (ui.input.value === captchaCode) {
                switchView('permMotion');
            } else {
                ui.status.innerText = "éªŒè¯ç é”™è¯¯ï¼Œè¯·é‡è¯•";
                ui.input.value = '';
                initCaptcha();
            }
        }

        // --- å…³å¡ 2: å¹³è¡¡ ---
        function requestMotionPermission() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(state => {
                        if (state === 'granted') {
                            window.addEventListener('deviceorientation', handleOrientation);
                            startLevel2();
                        } else alert('éœ€æˆæƒæ‰èƒ½éªŒè¯');
                    })
                    .catch(console.error);
            } else {
                window.addEventListener('deviceorientation', handleOrientation);
                startLevel2();
            }
        }

        function handleOrientation(e) {
            if (e.gamma !== null) tiltX = Math.max(-30, Math.min(30, e.gamma));
            if (e.beta !== null) tiltY = Math.max(20, Math.min(80, e.beta));
        }

        function startLevel2() {
            currentLevel = 2;
            switchView('game');
            showStage(2);
            ui.progress.style.width = '25%';
            
            let w = 5; // ç¨å®½ä¸€ç‚¹
            target = { x: Math.random()*(100-w), y: 0, w: w, h: 100 };
            ui.t2.style.left = target.x + '%';
            ui.t2.style.width = target.w + '%';
            
            if(!isGameRunning) {
                isGameRunning = true;
                requestAnimationFrame(gameLoop);
            }
        }

        // --- å…³å¡ 3: å®šä½ ---
        function startLevel3() {
            currentLevel = 3;
            showStage(3);
            ui.progress.style.width = '40%';
            holdTime = 0;
            
            let w=5, h=5;
            target = { x: Math.random()*(90-w)+5, y: Math.random()*(90-h)+5, w:w, h:h };
            ui.t3.style.left = target.x + '%';
            ui.t3.style.top = target.y + '%';
            ui.t3.style.width = target.w + '%';
            ui.t3.style.height = target.h + '%';
        }

        // --- å…³å¡ 4: å£°éŸ³ ---
        function pauseForMic() {
            isGameRunning = false;
            switchView('permMic');
        }

        async function reqMic() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;
                const source = audioContext.createMediaStreamSource(stream);
                source.connect(analyser);
                dataArray = new Uint8Array(analyser.frequencyBinCount);
                startLevel4();
            } catch(e) {
                console.error(e);
                alert("æ— æ³•è®¿é—®éº¦å…‹é£");
            }
        }

        function startLevel4() {
            currentLevel = 4;
            switchView('game');
            showStage(4);
            ui.progress.style.width = '55%';
            holdTime = 0;
            currentSmoothVol = 0;

            let rangeStart = Math.random() * (75 - 45) + 45; 
            micTargetRange = { min: rangeStart, max: rangeStart + 20 };
            ui.tMic.style.left = micTargetRange.min + '%';
            ui.tMic.style.width = 20 + '%';

            isGameRunning = true;
            requestAnimationFrame(gameLoop);
        }

        // --- å…³å¡ 5: é¢œè‰² ---
        function pauseForCam() {
            isGameRunning = false;
            if(audioContext) audioContext.close();
            switchView('permCamera');
        }

        async function reqCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                cameraStream = stream;
                video5.srcObject = stream;
                await video5.play();
                startLevel5();
            } catch(e) {
                console.error(e);
                alert("æ— æ³•è®¿é—®æ‘„åƒå¤´");
            }
        }

        function startLevel5() {
            currentLevel = 5;
            switchView('game');
            showStage(5);
            ui.progress.style.width = '70%';
            holdTime = 0;
            refreshCount5 = 3;
            
            randomTargetColor5();
            ui.refreshColorBtn5.onclick = () => {
                if(refreshCount5 > 0) {
                    randomTargetColor5();
                    refreshCount5--;
                    ui.refreshCounter5.innerText = refreshCount5;
                }
            };
            
            if(!isGameRunning) {
                isGameRunning = true;
                requestAnimationFrame(gameLoop);
            }
        }

        function randomTargetColor5() {
            targetColor5 = { r: Math.random()*255|0, g: Math.random()*255|0, b: Math.random()*255|0 };
            ui.targetSwatch5.style.backgroundColor = `rgb(${targetColor5.r},${targetColor5.g},${targetColor5.b})`;
            holdTime = 0;
        }

        function extractColor() {
            if (!video5 || video5.readyState < 2) return {r:0,g:0,b:0};
            try {
                ctx5.drawImage(video5, 0, 0, 32, 32);
                let data = ctx5.getImageData(10, 10, 12, 12).data;
                let r=0,g=0,b=0,c=0;
                for(let i=0; i<data.length; i+=4) { r+=data[i]; g+=data[i+1]; b+=data[i+2]; c++; }
                return { r: r/c, g: g/c, b: b/c };
            } catch(e) { return {r:0,g:0,b:0}; }
        }

        // --- æ¸¸æˆå¾ªç¯ (L2 - L5) ---
        function gameLoop() {
            if(!isGameRunning) return;
            let hit = false;
            let statusMsg = "";

            // L2 & L3
            if (currentLevel === 2 || currentLevel === 3) {
                let tx = tiltX, ty = tiltY;
                let targetX = (Math.max(-30, Math.min(30, tx)) + 30) * 100 / 60;
                player.x += (targetX - player.x) * 0.1;

                if (currentLevel === 3) {
                    let targetY = (Math.max(20, Math.min(80, ty)) - 20) * 100 / 60;
                    player.y += (targetY - player.y) * 0.1;
                }

                let inX = player.x > target.x && player.x < target.x + target.w;
                let inY = currentLevel === 3 ? (player.y > target.y && player.y < target.y + target.h) : true;
                hit = inX && inY;

                let el = currentLevel === 2 ? ui.b2 : ui.b3;
                el.style.left = player.x + '%';
                if(currentLevel === 3) el.style.top = player.y + '%';
                
                statusMsg = hit ? "ä¿æŒç¨³å®š..." : (currentLevel===2 ? "è°ƒæ•´è§’åº¦..." : "ç§»åŠ¨çƒä½“å…¥æ¡†...");
            }

            // L4
            if (currentLevel === 4) {
                if(analyser) {
                    analyser.getByteFrequencyData(dataArray);
                    let sum=0; for(let i of dataArray) sum+=i;
                    let vol = Math.min(Math.round((sum/dataArray.length)*2.5), 100);
                    currentSmoothVol += (vol - currentSmoothVol) * SMOOTHING_FACTOR;
                }
                ui.micBar.style.width = currentSmoothVol + '%';
                ui.volText.innerText = Math.round(currentSmoothVol);
                hit = currentSmoothVol > micTargetRange.min && currentSmoothVol < micTargetRange.max;
                statusMsg = hit ? "éŸ³é‡åˆé€‚ï¼Œä¿æŒ..." : (currentSmoothVol < micTargetRange.min ? "è¯·å¤§å£°ç‚¹" : "å£°éŸ³å¤ªå¤§äº†");
            }

            // L5
            if (currentLevel === 5) {
                currentColor5 = extractColor();
                ui.detectSwatch5.style.backgroundColor = `rgb(${currentColor5.r|0},${currentColor5.g|0},${currentColor5.b|0})`;
                let dist = Math.sqrt(Math.pow(currentColor5.r-targetColor5.r,2) + Math.pow(currentColor5.g-targetColor5.g,2) + Math.pow(currentColor5.b-targetColor5.b,2));
                ui.diffDisplay5.innerText = `å·®å€¼: ${dist.toFixed(0)}`;
                hit = dist < 75;
                statusMsg = hit ? "é¢œè‰²åŒ¹é…! ä¿æŒ..." : "å¯»æ‰¾ç›¸ä¼¼é¢œè‰²...";
            }

            // è®¡æ—¶é€»è¾‘
            let maxTime = currentLevel === 5 ? COLOR_HOLD_TIME : TARGET_TIME;
            if (hit) {
                holdTime += 16.6;
                ui.status.style.color = "#0F9D58";
            } else {
                holdTime = Math.max(0, holdTime - 50);
                ui.status.style.color = "#555";
            }

            ui.status.innerText = `${statusMsg} ${(Math.max(0, (maxTime-holdTime)/1000)).toFixed(1)}s`;

            if (holdTime >= maxTime) {
                if(currentLevel === 2) startLevel3();
                else if(currentLevel === 3) { pauseForMic(); return; }
                else if(currentLevel === 4) { pauseForCam(); return; }
                else if(currentLevel === 5) {
                    isGameRunning = false;
                    if(cameraStream) cameraStream.getTracks().forEach(t=>t.stop());
                    showSystemCheck();
                    return;
                }
            }
            requestAnimationFrame(gameLoop);
        }

        // --- ç³»ç»Ÿæ ¸æŸ¥ (è¿‡æ¸¡åŠ¨ç”») ---
        function showSystemCheck() {
            switchView('error');
            setTimeout(() => {
                ui.errorMessage.innerText = 'æ£€æµ‹åˆ°éå…¸å‹äººç±»è¡Œä¸ºæ¨¡å¼ (Error: 403)';
                setTimeout(startLevel6, 1500);
            }, 1500);
        }

        // --- å…³å¡ 6: åœ°ç‹±å¤é€‰æ¡† (Source 2 Logic) ---
        function startLevel6() {
            currentLevel = 6;
            switchView('game');
            showStage(6);
            ui.progress.style.width = '85%';
            ui.status.innerText = "";
            ui.level6Status.innerText = "";
            
            // åˆå§‹åŒ–æ»šåŠ¨åˆ—è¡¨
            initLevel6List();
        }

        function initLevel6List() {
            ui.scrollList.innerHTML = '';
            currentFound6 = 0;
            document.getElementById('correct-count').innerText = 0;
            
            // æ‰“ä¹±é¡ºåº
            const shuffled = [...hellOptions].sort(() => Math.random() - 0.5);

            shuffled.forEach(item => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `<div class="box"></div><span>${item.t}</span>`;
                
                // ç»‘å®šç‚¹å‡»äº‹ä»¶ (Source 2 é€»è¾‘)
                div.onclick = () => {
                    div.classList.toggle('selected');
                    // å†…éƒ¨è®¡æ•°
                    if(div.classList.contains('selected')) { 
                        if(item.v) currentFound6++; 
                    } else { 
                        if(item.v) currentFound6--; 
                    }
                    // æ›´æ–°UI
                    document.getElementById('correct-count').innerText = Math.max(0, currentFound6);
                };
                ui.scrollList.appendChild(div);
            });
        }

        function checkLevel6() {
            const totalSelected = document.querySelectorAll('.item.selected').length;
            
            // Source 2 çš„éªŒè¯é€»è¾‘ï¼šå¿…é¡»æ‰¾åˆ°3ä¸ªæ­£ç¡®çš„ï¼Œä¸”æ€»é€‰æ‹©æ•°ä¹Ÿæ˜¯3ä¸ªï¼ˆæ„å‘³ç€æ²¡æœ‰é€‰é”™ï¼‰
            // æ³¨æ„ï¼šåŸå§‹æ•°æ®ä¸­ v=true çš„ç¡®å®åªæœ‰3ä¸ª
            if (currentFound6 === 3 && totalSelected === 3) {
                 finishGame();
            } else {
                // å¤±è´¥éœ‡åŠ¨æ•ˆæœ
                const container = document.getElementById('modal-container');
                container.classList.add('shake');
                setTimeout(() => container.classList.remove('shake'), 400);
                
                ui.level6Status.innerText = "éªŒè¯å¤±è´¥ï¼šè¯·åŠ¡å¿…åªå‹¾é€‰æ‰€æœ‰æ­£ç¡®çš„æè¿°ï¼åˆ—è¡¨å·²é‡ç½®ã€‚";
                setTimeout(initLevel6List, 1000); // 1ç§’åé‡ç½®åˆ—è¡¨
            }
        }

        // --- æˆåŠŸ & æœºå™¨ç  (Source 1 Logic) ---
        async function finishGame() {
            ui.progress.style.width = '100%';
            switchView('success');
            
            const codeEl = ui.deviceCode;
            try {
                const res = await fetch('https://api64.ipify.org?format=json');
                const data = await res.json();
                let nums = data.ip.replace(/[^0-9]/g, '');
                if(!nums) throw new Error();
                
                let code = BigInt(nums) * 3n;
                codeEl.innerText = code.toString();
            } catch(e) {
                // å¦‚æœAPIå¤±è´¥ï¼Œä½¿ç”¨ Source 2 çš„ä¼ªé€ é€»è¾‘ä½œä¸ºå¤‡é€‰
                const token = "2001:0db8:" + Math.floor(Math.random()*9999) + ":0000:8a2e:" + Math.floor(Math.random()*9999);
                codeEl.innerText = token;
            }
            
            // è·³è½¬é€»è¾‘ (ä¿æŒ Source 1 çš„ Bç«™è·³è½¬)
            let cd = 5;
            ui.redirectTip.innerText = `å°†åœ¨ ${cd} ç§’åè·³è½¬...`;
            
            let countdownInterval = setInterval(() => {
                cd--;
                ui.redirectTip.innerText = `å°†åœ¨ ${cd} ç§’åè·³è½¬...`;
                if(cd <= 0) {
                    clearInterval(countdownInterval);
                    location.href = 'https://b23.tv/mDG1nfg';
                }
            }, 1000);
        }
        
        // --- æŒ‰é’®ä»£ç† ---
        function handleAction() {
            // æ­¤å‡½æ•°ç”± onclick ç»‘å®šï¼Œå…·ä½“é€»è¾‘åœ¨ updateButton ä¸­åŠ¨æ€æŒ‡å®š
        }
    </script>
</body>
</html>